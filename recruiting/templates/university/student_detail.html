<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Student Profile</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>

<body class="p-4 bg-light">

<h2>Student Details</h2>
<div id="profile"></div>

<script>
const id = "{{ student_id }}";
const token = localStorage.getItem("access");

async function loadProfile() {
    const res = await fetch(`/api/profiles/${id}/`, {
        headers: { "Authorization": "Bearer " + token }
    });
    const p = await res.json();

    document.getElementById("profile").innerHTML = `
        <div class="card p-3 shadow">
            <h4>${p.user.email}</h4>
            <p><b>Field:</b> ${p.field_of_study}</p>
            <p><b>GPA:</b> ${p.gpa}</p>
            <p><b>Score:</b> ${p.score}</p>

            <hr>
            <h5>Skills</h5>
            <ul>${p.skills.map(s => `<li>${s.name}</li>`).join("")}</ul>

            <h5>Applications</h5>
            <ul id="apps"></ul>
        </div>
    `;

    const apps = await fetch(`/api/applications/?user=${id}`, {
        headers: { "Authorization": "Bearer " + token }
    }).then(r => r.json());

    document.getElementById("apps").innerHTML = apps.map(a => `
        <li>${a.offer.title} â€“ <b>${a.status}</b></li>
    `).join("");
}

loadProfile();
</script>

</body>
</html>
