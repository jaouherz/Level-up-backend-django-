<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Internship Demands</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>

<body class="p-4 bg-light">

<h2 class="mb-4">Pending Internship Demands</h2>

<div id="demandContainer" class="mt-4"></div>

<script>
const access = localStorage.getItem("access");
if (!access) window.location.href = "/api/auth/jwt-login/";

async function loadDemands() {
    const res = await fetch("/api/internship-demands/university_demands/", {
        headers: { "Authorization": "Bearer " + access }
    });

    const data = await res.json();
    const container = document.getElementById("demandContainer");
    container.innerHTML = "";

    data.forEach(d => {
        container.innerHTML += `
            <div class="card mb-3 shadow">
                <div class="card-body">
                    <h4>${d.student.email}</h4>
                    <p><strong>Offer:</strong> ${d.application.offer.title}</p>
                    <p><strong>Status:</strong> ${d.status}</p>

                    <button class="btn btn-success"
                        onclick="approveDemand(${d.id})">Approve</button>

                    <button class="btn btn-danger"
                        onclick="rejectDemand(${d.id})">Reject</button>

                    <a href="/university/student/${d.student.id}/"
                       class="btn btn-primary float-end">View Profile</a>
                </div>
            </div>
        `;
    });
}

async function approveDemand(id) {
    await fetch(`/api/internship-demands/${id}/approve/`, {
        method: "POST",
        headers: { "Authorization": "Bearer " + access }
    });
    loadDemands();
}

async function rejectDemand(id) {
    await fetch(`/api/internship-demands/${id}/reject/`, {
        method: "POST",
        headers: { "Authorization": "Bearer " + access }
    });
    loadDemands();
}

loadDemands();
</script>
</body>
</html>
