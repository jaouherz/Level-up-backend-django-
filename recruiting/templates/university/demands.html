<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Internship Demands</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>

<body class="p-4">

<h2 class="mb-3">Pending Internship Demands</h2>

<div id="demandContainer"></div>

<script>
const token = localStorage.getItem("access");

async function loadDemands() {
    const res = await fetch("/api/internship-demands/university_demands/", {
        headers: { "Authorization": "Bearer " + token }
    });

    if (!res.ok) {
        document.getElementById("demandContainer").innerHTML =
            "<p class='text-danger'>Error loading demands.</p>";
        return;
    }

    const demands = await res.json();
    const container = document.getElementById("demandContainer");
    container.innerHTML = "";

    demands.forEach(d => {
        container.innerHTML += `
            <div class="card mb-3 shadow">
                <div class="card-body">
                    <h5>Student: ${d.student}</h5>
                    <p>Application ID: ${d.application}</p>
                    <p>Status: <strong>${d.status}</strong></p>

                    ${d.status === "pending" ? `
                    <button class="btn btn-success me-2" onclick="approve(${d.id})">
                        Approve
                    </button>
                    <button class="btn btn-danger" onclick="reject(${d.id})">
                        Reject
                    </button>
                    ` : ""}
                </div>
            </div>
        `;
    });
}

async function approve(id) {
    await fetch(`/api/internship-demands/${id}/approve/`, {
        method: "POST",
        headers: { "Authorization": "Bearer " + token }
    });
    loadDemands();
}

async function reject(id) {
    await fetch(`/api/internship-demands/${id}/reject/`, {
        method: "POST",
        headers: { "Authorization": "Bearer " + token }
    });
    loadDemands();
}

loadDemands();
</script>

</body>
</html>
